CKEDITOR.plugins.add("richcombo",{requires:["floatpanel","listblock","button"],beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}});CKEDITOR.UI_RICHCOMBO="richcombo";CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(a){CKEDITOR.tools.extend(this,a,{title:a.label,modes:{wysiwyg:1}});var b=this.panel||{};delete this.panel;this.id=CKEDITOR.tools.getNextNumber();this.document=(b&&b.parent&&b.parent.getDocument())||CKEDITOR.document;b.className=(b.className||"")+" cke_rcombopanel";b.block={multiSelect:b.multiSelect,attributes:b.attributes};this._={panelDefinition:b,items:{},state:CKEDITOR.TRISTATE_OFF}},statics:{handler:{create:function(a){return new CKEDITOR.ui.richCombo(a)}}},proto:{renderHtml:function(b){var a=[];this.render(b,a);return a.join("")},render:function(e,d){var f=CKEDITOR.env;var c="cke_"+this.id;var a=CKEDITOR.tools.addFunction(function(j){var k=this._;if(k.state==CKEDITOR.TRISTATE_DISABLED){return}this.createPanel(e);if(k.on){k.panel.hide();return}this.commit();var l=this.getValue();if(l){k.list.mark(l)}else{k.list.unmarkAll()}k.panel.showBlock(this.id,new CKEDITOR.dom.element(j),4)},this);var h={id:c,combo:this,focus:function(){var j=CKEDITOR.document.getById(c).getChild(1);j.focus()},clickFn:a};function i(){var j=this.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;this.setState(e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:j);this.setValue("")}e.on("mode",i,this);!this.readOnly&&e.on("readOnly",i,this);var g=CKEDITOR.tools.addFunction(function(k,j){k=new CKEDITOR.dom.event(k);var l=k.getKeystroke();switch(l){case 13:case 32:case 40:CKEDITOR.tools.callFunction(a,j);break;default:h.onkey(h,l)}k.preventDefault()});var b=CKEDITOR.tools.addFunction(function(){h.onfocus&&h.onfocus()});h.keyDownFn=g;d.push('<span class="cke_rcombo" role="presentation">',"<span id=",c);if(this.className){d.push(' class="',this.className,' cke_off"')}d.push(' role="presentation">','<span id="'+c+'_label" class=cke_label>',this.label,"</span>",'<a hidefocus=true title="',this.title,'" tabindex="-1"',f.gecko&&f.version>=10900&&!f.hc?"":" href=\"javascript:void('"+this.label+"')\"",' role="button" aria-labelledby="',c,'_label" aria-describedby="',c,'_text" aria-haspopup="true"');if(CKEDITOR.env.opera||(CKEDITOR.env.gecko&&CKEDITOR.env.mac)){d.push(' onkeypress="return false;"')}if(CKEDITOR.env.gecko){d.push(' onblur="this.style.cssText = this.style.cssText;"')}d.push(' onkeydown="CKEDITOR.tools.callFunction( ',g,', event, this );" onfocus="return CKEDITOR.tools.callFunction(',b,', event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction(',a,', this); return false;"><span><span id="'+c+'_text" class="cke_text cke_inline_label">'+this.label+"</span></span><span class=cke_openbutton><span class=cke_icon>"+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span></span>");if(this.onRender){this.onRender()}return h},createPanel:function(b){if(this._.panel){return}var g=this._.panelDefinition,f=this._.panelDefinition.block,e=g.parent||CKEDITOR.document.getBody(),a=new CKEDITOR.ui.floatPanel(b,e,g),d=a.addListBlock(this.id,f),c=this;a.onShow=function(){if(c.className){this.element.getFirst().addClass(c.className+"_panel")}c.setState(CKEDITOR.TRISTATE_ON);d.focus(!c.multiSelect&&c.getValue());c._.on=1;if(c.onOpen){c.onOpen()}};a.onHide=function(h){if(c.className){this.element.getFirst().removeClass(c.className+"_panel")}c.setState(c.modes&&c.modes[b.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);c._.on=0;if(!h&&c.onClose){c.onClose()}};a.onEscape=function(){a.hide()};d.onClick=function(i,h){c.document.getWindow().focus();if(c.onClick){c.onClick.call(c,i,h)}if(h){c.setValue(i,c._.items[i])}else{c.setValue("")}a.hide(false)};this._.panel=a;this._.list=d;a.getBlock(this.id).onHide=function(){c._.on=0;c.setState(CKEDITOR.TRISTATE_OFF)};if(this.init){this.init()}},setValue:function(b,c){this._.value=b;var a=this.document.getById("cke_"+this.id+"_text");if(a){if(!(b||c)){c=this.label;a.addClass("cke_inline_label")}else{a.removeClass("cke_inline_label")}a.setHtml(typeof c!="undefined"?c:b)}},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(a){this._.list.mark(a)},hideItem:function(a){this._.list.hideItem(a)},hideGroup:function(a){this._.list.hideGroup(a)},showAll:function(){this._.list.showAll()},add:function(b,a,c){this._.items[b]=c||b;this._.list.add(b,a,c)},startGroup:function(a){this._.list.startGroup(a)},commit:function(){if(!this._.committed){this._.list.commit();this._.committed=1;CKEDITOR.ui.fire("ready",this)}this._.committed=1},setState:function(a){if(this._.state==a){return}this.document.getById("cke_"+this.id).setState(a);this._.state=a}}});CKEDITOR.ui.prototype.addRichCombo=function(a,b){this.add(a,CKEDITOR.UI_RICHCOMBO,b)};