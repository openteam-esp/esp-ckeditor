(function(){var c=function(o,q){var p=o.document,m=p.getBody();var n=0;var r=function(){n=1};m.on(q,r);(CKEDITOR.env.version>7?p.$:p.$.selection.createRange())["execCommand"](q);m.removeListener(q,r);return n};var h=CKEDITOR.env.ie?function(n,m){return c(n,m)}:function(n,m){try{return n.document.$.execCommand(m,false,null)}catch(o){return false}};var k=function(m){this.type=m;this.canUndo=this.type=="cut";this.startDisabled=true};k.prototype={exec:function(m,n){this.type=="cut"&&i(m);var o=h(m,this.type);if(!o){alert(m.lang.clipboard[this.type+"Error"])}return o}};var g={canUndo:false,exec:CKEDITOR.env.ie?function(m){m.focus();if(!m.document.getBody().fire("beforepaste")&&!c(m,"paste")){m.fire("pasteDialog");return false}}:function(m){try{if(!m.document.getBody().fire("beforepaste")&&!m.document.$.execCommand("Paste",false,null)){throw 0}}catch(n){setTimeout(function(){m.fire("pasteDialog")},0);return false}}};var f=function(o){if(this.mode!="wysiwyg"){return}switch(o.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:var m=this.document.getBody();if(!CKEDITOR.env.ie&&m.fire("beforepaste")){o.cancel()}else{if(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.version<10900){m.fire("paste")}}return;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:var n=this;this.fire("saveSnapshot");setTimeout(function(){n.fire("saveSnapshot")},0)}};function l(m){m.cancel()}function j(u,q,v){var s=this.document;if(s.getById("cke_pastebin")){return}if(q=="text"&&u.data&&u.data.$.clipboardData){var t=u.data.$.clipboardData.getData("text/plain");if(t){u.data.preventDefault();v(t);return}}var m=this.getSelection(),p=new CKEDITOR.dom.range(s);var n=new CKEDITOR.dom.element(q=="text"?"textarea":CKEDITOR.env.webkit?"body":"div",s);n.setAttribute("id","cke_pastebin");CKEDITOR.env.webkit&&n.append(s.createText("\xa0"));s.getBody().append(n);n.setStyles({position:"absolute",top:m.getStartElement().getDocumentPosition().y+"px",width:"1px",height:"1px",overflow:"hidden"});n.setStyle(this.config.contentsLangDirection=="ltr"?"left":"right","-1000px");var o=m.createBookmarks();this.on("selectionChange",l,null,null,0);if(q=="text"){n.$.focus()}else{p.setStartAt(n,CKEDITOR.POSITION_AFTER_START);p.setEndAt(n,CKEDITOR.POSITION_BEFORE_END);p.select(true)}var r=this;window.setTimeout(function(){q=="text"&&CKEDITOR.env.gecko&&r.focusGrabber.focus();n.remove();r.removeListener("selectionChange",l);var w;n=(CKEDITOR.env.webkit&&(w=n.getFirst())&&(w.is&&w.hasClass("Apple-style-span"))?w:n);m.selectBookmarks(o);v(n["get"+(q=="text"?"Value":"Html")]())},0)}function i(n){if(!CKEDITOR.env.ie||CKEDITOR.env.quirks){return}var o=n.getSelection();var q;if((o.getType()==CKEDITOR.SELECTION_ELEMENT)&&(q=o.getSelectedElement())){var m=o.getRanges()[0];var p=n.document.createText("");p.insertBefore(q);m.setStartBefore(p);m.setEndAfter(q);o.selectRanges([m]);setTimeout(function(){if(q.getParent()){p.remove();o.selectElement(q)}},0)}}var b;function a(o,n){CKEDITOR.env.ie&&(b=1);var m=CKEDITOR.TRISTATE_OFF;try{m=n.document.$.queryCommandEnabled(o)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}catch(p){}b=0;return m}var d;function e(){if(this.mode!="wysiwyg"){return}this.getCommand("cut").setState(d?CKEDITOR.TRISTATE_DISABLED:a("Cut",this));this.getCommand("copy").setState(a("Copy",this));var m=d?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.env.webkit?CKEDITOR.TRISTATE_OFF:a("Paste",this);this.fire("pasteState",m)}CKEDITOR.plugins.add("clipboard",{requires:["dialog","htmldataprocessor"],init:function(m){m.on("paste",function(o){var p=o.data;if(p.html){m.insertHtml(p.html)}else{if(p.text){m.insertText(p.text)}}setTimeout(function(){m.fire("afterPaste")},0)},null,null,1000);m.on("pasteDialog",function(o){setTimeout(function(){m.openDialog("paste")},0)});m.on("pasteState",function(o){m.getCommand("paste").setState(o.data)});function n(o,q,s,p){var r=m.lang[q];m.addCommand(q,s);m.ui.addButton(o,{label:r,command:q});if(m.addMenuItems){m.addMenuItem(q,{label:r,command:q,group:"clipboard",order:p})}}n("Cut","cut",new k("cut"),1);n("Copy","copy",new k("copy"),4);n("Paste","paste",g,8);CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js"));m.on("key",f,m);m.on("contentDom",function(){var o=m.document.getBody();o.on(CKEDITOR.env.webkit?"paste":"beforepaste",function(p){if(b){return}var q={mode:"html"};m.fire("beforePaste",q);j.call(m,p,q.mode,function(s){if(!(s=CKEDITOR.tools.trim(s.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/ig,"")))){return}var r={};r[q.mode]=s;m.fire("paste",r)})});o.on("contextmenu",function(){b=1;setTimeout(function(){b=0},10)});o.on("beforecut",function(){!b&&i(m)});o.on("mouseup",function(){setTimeout(function(){e.call(m)},0)},m);o.on("keyup",e,m)});m.on("selectionChange",function(o){d=o.data.selection.getRanges()[0].checkReadOnly();e.call(m)});if(m.contextMenu){m.contextMenu.addListener(function(o,p){var q=p.getRanges()[0].checkReadOnly();return{cut:!q&&a("Cut",m),copy:a("Copy",m),paste:!q&&(CKEDITOR.env.webkit?CKEDITOR.TRISTATE_OFF:a("Paste",m))}})}}})})();