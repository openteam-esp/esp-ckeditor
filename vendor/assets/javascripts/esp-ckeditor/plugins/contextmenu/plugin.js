CKEDITOR.plugins.add("contextmenu",{requires:["menu"],onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(a){this.base.call(this,a,{panel:{className:a.skinClass+" cke_contextmenu",attributes:{"aria-label":a.lang.contextmenu.options}}})},proto:{addTarget:function(d,e){if(CKEDITOR.env.opera&&!("oncontextmenu" in document.body)){var a;d.on("mousedown",function(g){g=g.data;if(g.$.button!=2){if(g.getKeystroke()==CKEDITOR.CTRL+1){d.fire("contextmenu",g)}return}if(e&&(CKEDITOR.env.mac?g.$.metaKey:g.$.ctrlKey)){return}var i=g.getTarget();if(!a){var h=i.getDocument();a=h.createElement("input");a.$.type="button";h.getBody().append(a)}a.setAttribute("style","position:absolute;top:"+(g.$.clientY-2)+"px;left:"+(g.$.clientX-2)+"px;width:5px;height:5px;opacity:0.01")});d.on("mouseup",function(g){if(a){a.remove();a=undefined;d.fire("contextmenu",g.data)}})}d.on("contextmenu",function(j){var h=j.data;if(e&&(CKEDITOR.env.webkit?b:(CKEDITOR.env.mac?h.$.metaKey:h.$.ctrlKey))){return}h.preventDefault();var i=h.getTarget().getDocument().getDocumentElement(),g=h.$.clientX,k=h.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(i,null,g,k)},CKEDITOR.env.ie?200:0,this)},this);if(CKEDITOR.env.opera){d.on("keypress",function(g){var h=g.data;if(h.$.keyCode===0){h.preventDefault()}})}if(CKEDITOR.env.webkit){var b,c=function(g){b=CKEDITOR.env.mac?g.data.$.metaKey:g.data.$.ctrlKey},f=function(){b=0};d.on("keydown",c);d.on("keyup",f);d.on("contextmenu",f)}},open:function(c,b,a,d){this.editor.focus();c=c||CKEDITOR.document.getDocumentElement();this.show(c,b,a,d)}}})},beforeInit:function(a){a.contextMenu=new CKEDITOR.plugins.contextMenu(a);a.addCommand("contextMenu",{exec:function(){a.contextMenu.open(a.document.getBody())}})}});