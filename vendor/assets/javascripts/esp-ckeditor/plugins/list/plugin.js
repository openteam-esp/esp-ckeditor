(function(){var r={ol:1,ul:1},d=/^[\n\r\t ]*$/;var m=CKEDITOR.dom.walker.whitespaces(),e=CKEDITOR.dom.walker.bookmark(),h=function(i){return !(m(i)||e(i))};function c(w){var v,x,i;if((v=w.getDirection())){x=w.getParent();while(x&&!(i=x.getDirection())){x=x.getParent()}if(v==i){w.removeAttribute("dir")}}}CKEDITOR.plugins.list={listToArray:function(y,G,E,D,F){if(!r[y.getName()]){return[]}if(!D){D=0}if(!E){E=[]}for(var A=0,B=y.getChildCount();A<B;A++){var v=y.getChild(A);if(v.type==CKEDITOR.NODE_ELEMENT&&v.getName() in CKEDITOR.dtd.$list){CKEDITOR.plugins.list.listToArray(v,G,E,D+1)}if(v.$.nodeName.toLowerCase()!="li"){continue}var C={parent:y,indent:D,element:v,contents:[]};if(!F){C.grandparent=y.getParent();if(C.grandparent&&C.grandparent.$.nodeName.toLowerCase()=="li"){C.grandparent=C.grandparent.getParent()}}else{C.grandparent=F}if(G){CKEDITOR.dom.element.setMarker(G,v,"listarray_index",E.length)}E.push(C);for(var z=0,w=v.getChildCount(),x;z<w;z++){x=v.getChild(z);if(x.type==CKEDITOR.NODE_ELEMENT&&r[x.getName()]){CKEDITOR.plugins.list.listToArray(x,G,E,D+1,C.grandparent)}else{C.contents.push(x)}}}return E},arrayToList:function(B,F,G,R,J){if(!G){G=0}if(!B||B.length<G+1){return null}var Q=B[G].parent.getDocument(),I=new CKEDITOR.dom.documentFragment(Q),P=null,x=G,K=Math.max(B[G].indent,0),v=null,z,E=(R==CKEDITOR.ENTER_P?"p":"div");while(1){var N=B[x];z=N.element.getDirection(1);if(N.indent==K){if(!P||B[x].parent.getName()!=P.getName()){P=B[x].parent.clone(false,1);J&&P.setAttribute("dir",J);I.append(P)}v=P.append(N.element.clone(0,1));if(z!=P.getDirection(1)){v.setAttribute("dir",z)}for(var M=0;M<N.contents.length;M++){v.append(N.contents[M].clone(1,1))}x++}else{if(N.indent==Math.max(K,0)+1){var L=B[x-1].element.getDirection(1),H=CKEDITOR.plugins.list.arrayToList(B,null,x,R,L!=z?z:null);if(!v.getChildCount()&&CKEDITOR.env.ie&&!(Q.$.documentMode>7)){v.append(Q.createText("\xa0"))}v.append(H.listNode);x=H.nextIndex}else{if(N.indent==-1&&!G&&N.grandparent){if(r[N.grandparent.getName()]){v=N.element.clone(false,true)}else{if(J||N.element.hasAttributes()||R!=CKEDITOR.ENTER_BR){v=Q.createElement(E);N.element.copyAttributes(v,{type:1,value:1});if(!J&&R==CKEDITOR.ENTER_BR&&!v.hasAttributes()){v=new CKEDITOR.dom.documentFragment(Q)}}else{v=new CKEDITOR.dom.documentFragment(Q)}}if(v.type==CKEDITOR.NODE_ELEMENT){if(N.grandparent.getDirection(1)!=z){v.setAttribute("dir",z)}}for(M=0;M<N.contents.length;M++){v.append(N.contents[M].clone(1,1))}if(v.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&x!=B.length-1){var D=v.getLast();if(D&&D.type==CKEDITOR.NODE_ELEMENT&&D.getAttribute("type")=="_moz"){D.remove()}if(!(D=v.getLast(h)&&D.type==CKEDITOR.NODE_ELEMENT&&D.getName() in CKEDITOR.dtd.$block)){v.append(Q.createElement("br"))}}if(v.type==CKEDITOR.NODE_ELEMENT&&v.getName()==E&&v.$.firstChild){v.trim();var w=v.getFirst();if(w.type==CKEDITOR.NODE_ELEMENT&&w.isBlockBoundary()){var O=new CKEDITOR.dom.documentFragment(Q);v.moveChildren(O);v=O}}var C=v.$.nodeName.toLowerCase();if(!CKEDITOR.env.ie&&(C=="div"||C=="p")){v.appendBogus()}I.append(v);P=null;x++}else{return null}}}if(B.length<=x||Math.max(B[x].indent,0)<K){break}}if(F){var y=I.getFirst(),A=B[0].parent;while(y){if(y.type==CKEDITOR.NODE_ELEMENT){CKEDITOR.dom.element.clearMarkers(F,y);if(y.getName() in CKEDITOR.dtd.$listItem){c(y)}}y=y.getNextSourceNode()}}return{listNode:I,nextIndex:x}}};function k(v){if(v.editor.readOnly){return null}var A=v.data.path,w=A.blockLimit,z=A.elements,y,x;for(x=0;x<z.length&&(y=z[x])&&!y.equals(w);x++){if(r[z[x].getName()]){return this.setState(this.type==z[x].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}}return this.setState(CKEDITOR.TRISTATE_OFF)}function j(E,D,H,I){var A=CKEDITOR.plugins.list.listToArray(D.root,H),G=[];for(var C=0;C<D.contents.length;C++){var y=D.contents[C];y=y.getAscendant("li",true);if(!y||y.getCustomData("list_item_processed")){continue}G.push(y);CKEDITOR.dom.element.setMarker(H,y,"list_item_processed",true)}var F=D.root,B=F.getDocument().createElement(this.type);F.copyAttributes(B,{start:1,type:1});B.removeStyle("list-style-type");for(C=0;C<G.length;C++){var z=G[C].getCustomData("listarray_index");A[z].parent=B}var x=CKEDITOR.plugins.list.arrayToList(A,H,null,E.config.enterMode);var w,v=x.listNode.getChildCount();for(C=0;C<v&&(w=x.listNode.getChild(C));C++){if(w.getName()==this.type){I.push(w)}}x.listNode.replace(D.root)}var u=/^h[1-6]$/;function b(w,B,A){var J=B.contents,N=B.root.getDocument(),L=[];if(J.length==1&&J[0].equals(B.root)){var I=N.createElement("div");J[0].moveChildren&&J[0].moveChildren(I);J[0].append(I);J[0]=I}var F=B.contents[0].getParent();for(var H=0;H<J.length;H++){F=F.getCommonAncestor(J[H].getParent())}var K=w.config.useComputedState,G,v;K=K===undefined||K;for(H=0;H<J.length;H++){var y=J[H],C;while((C=y.getParent())){if(C.equals(F)){L.push(y);if(!v&&y.getDirection()){v=1}var E=y.getDirection(K);if(G!==null){if(G&&G!=E){G=null}else{G=E}}break}y=C}}if(L.length<1){return}var M=L[L.length-1].getNext(),x=N.createElement(this.type);A.push(x);var z,D;while(L.length){z=L.shift();D=N.createElement("li");if(z.is("pre")||u.test(z.getName())){z.appendTo(D)}else{z.copyAttributes(D);if(G&&z.getDirection()){D.removeStyle("direction");D.removeAttribute("dir")}z.moveChildren(D);z.remove()}D.appendTo(x)}if(G&&v){x.setAttribute("dir",G)}if(M){x.insertBefore(M)}else{x.appendTo(F)}}function t(E,D,K){var A=CKEDITOR.plugins.list.listToArray(D.root,K),I=[];for(var B=0;B<D.contents.length;B++){var x=D.contents[B];x=x.getAscendant("li",true);if(!x||x.getCustomData("list_item_processed")){continue}I.push(x);CKEDITOR.dom.element.setMarker(K,x,"list_item_processed",true)}var F=null;for(B=0;B<I.length;B++){var z=I[B].getCustomData("listarray_index");A[z].indent=-1;F=z}for(B=F+1;B<A.length;B++){if(A[B].indent>A[B-1].indent+1){var H=A[B-1].indent+1-A[B].indent;var y=A[B].indent;while(A[B]&&A[B].indent>=y){A[B].indent+=H;B++}B--}}var w=CKEDITOR.plugins.list.arrayToList(A,K,null,E.config.enterMode,D.root.getAttribute("dir"));var G=w.listNode,v,C;function J(i){if((v=G[i?"getFirst":"getLast"]())&&!(v.is&&v.isBlockBoundary())&&(C=D.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(true)))&&!(C.is&&C.isBlockBoundary({br:1}))){E.document.createElement("br")[i?"insertBefore":"insertAfter"](v)}}J(true);J();G.replace(D.root)}function o(i,v){this.name=i;this.type=v}function f(y){var v=y.getDirection();if(v){for(var x=0,w=y.getChildren(),z;z=w.getItem(x),x<w.count();x++){if(z.type==CKEDITOR.NODE_ELEMENT&&z.is("li")&&!z.getDirection()){z.setAttribute("dir",v)}}y.removeAttribute("dir")}}o.prototype={exec:function(x){var Z=x.document,W=x.config,Y=x.getSelection(),w=Y&&Y.getRanges(true);if(!w||w.length<1){return}if(this.state==CKEDITOR.TRISTATE_OFF){var H=Z.getBody();if(!H.getFirst(h)){W.enterMode==CKEDITOR.ENTER_BR?H.appendBogus():w[0].fixBlock(1,W.enterMode==CKEDITOR.ENTER_P?"p":"div");Y.selectRanges(w)}else{var J=w.length==1&&w[0],T=J&&J.getEnclosedNode();if(T&&T.is&&this.type==T.getName()){this.setState(CKEDITOR.TRISTATE_ON)}}}var z=Y.createBookmarks(true);var U=[],I={},G=w.createIterator(),B=0;while((J=G.getNextRange())&&++B){var S=J.getBoundaryNodes(),X=S.startNode,K=S.endNode;if(X.type==CKEDITOR.NODE_ELEMENT&&X.getName()=="td"){J.setStartAt(S.startNode,CKEDITOR.POSITION_AFTER_START)}if(K.type==CKEDITOR.NODE_ELEMENT&&K.getName()=="td"){J.setEndAt(S.endNode,CKEDITOR.POSITION_BEFORE_END)}var M=J.createIterator(),F;M.forceBrBreak=(this.state==CKEDITOR.TRISTATE_OFF);while((F=M.getNextParagraph())){if(F.getCustomData("list_block")){continue}else{CKEDITOR.dom.element.setMarker(I,F,"list_block",1)}var L=new CKEDITOR.dom.elementPath(F),V=L.elements,R=V.length,y=null,E=0,A=L.blockLimit,v;for(var Q=R-1;Q>=0&&(v=V[Q]);Q--){if(r[v.getName()]&&A.contains(v)){A.removeCustomData("list_group_object_"+B);var D=v.getCustomData("list_group_object");if(D){D.contents.push(F)}else{D={root:v,contents:[F]};U.push(D);CKEDITOR.dom.element.setMarker(I,v,"list_group_object",D)}E=1;break}}if(E){continue}var P=A;if(P.getCustomData("list_group_object_"+B)){P.getCustomData("list_group_object_"+B).contents.push(F)}else{D={root:P,contents:[F]};CKEDITOR.dom.element.setMarker(I,P,"list_group_object_"+B,D);U.push(D)}}}var C=[];while(U.length>0){D=U.shift();if(this.state==CKEDITOR.TRISTATE_OFF){if(r[D.root.getName()]){j.call(this,x,D,I,C)}else{b.call(this,x,D,C)}}else{if(this.state==CKEDITOR.TRISTATE_ON&&r[D.root.getName()]){t.call(this,x,D,I)}}}for(Q=0;Q<C.length;Q++){y=C[Q];var N,O=this;(N=function(aa){var i=y[aa?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(true));if(i&&i.getName&&i.getName()==O.type){if(i.getDirection(1)!=y.getDirection(1)){f(y.getDirection()?y:i)}i.remove();i.moveChildren(y,aa)}})();N(1)}CKEDITOR.dom.element.clearAllMarkers(I);Y.selectBookmarks(z);x.focus()}};var n=CKEDITOR.dtd;var s=/[\t\r\n ]*(?:&nbsp;|\xa0)$/;function l(x,A){var z,w=x.children,y=w.length;for(var v=0;v<y;v++){z=w[v];if(z.name&&(z.name in A)){return v}}return y}function a(i){return function(A){var x=A.children,z=l(A,n.$list),w=x[z],v=w&&w.previous,B;if(v&&(v.name&&v.name=="br"||v.value&&(B=v.value.match(s)))){var y=v;if(!(B&&B.index)&&y==x[0]){x[0]=(i||CKEDITOR.env.ie)?new CKEDITOR.htmlParser.text("\xa0"):new CKEDITOR.htmlParser.element("br",{})}else{if(y.name=="br"){x.splice(z-1,1)}else{y.value=y.value.replace(s,"")}}}}}var g={elements:{}};for(var p in n.$listItem){g.elements[p]=a()}var q={elements:{}};for(p in n.$listItem){q.elements[p]=a(true)}CKEDITOR.plugins.add("list",{init:function(v){var w=v.addCommand("numberedlist",new o("numberedlist","ol")),i=v.addCommand("bulletedlist",new o("bulletedlist","ul"));v.ui.addButton("NumberedList",{label:v.lang.numberedlist,command:"numberedlist"});v.ui.addButton("BulletedList",{label:v.lang.bulletedlist,command:"bulletedlist"});v.on("selectionChange",CKEDITOR.tools.bind(k,w));v.on("selectionChange",CKEDITOR.tools.bind(k,i))},afterInit:function(v){var i=v.dataProcessor;if(i){i.dataFilter.addRules(g);i.htmlFilter.addRules(q)}},requires:["domiterator"]})})();