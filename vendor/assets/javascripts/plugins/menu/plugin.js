CKEDITOR.plugins.add("menu",{beforeInit:function(d){var a=d.config.menu_groups.split(","),e=d._.menuGroups={},c=d._.menuItems={};for(var b=0;b<a.length;b++){e[a[b]]=b+1}d.addMenuGroup=function(g,f){e[g]=f||100};d.addMenuItem=function(f,g){if(e[g.group]){c[f]=new CKEDITOR.menuItem(this,f,g)}};d.addMenuItems=function(f){for(var g in f){this.addMenuItem(g,f[g])}};d.getMenuItem=function(f){return c[f]};d.removeMenuItem=function(f){delete c[f]}},requires:["floatpanel"]});(function(){CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(d,c){c=this._.definition=c||{};this.id=CKEDITOR.tools.getNextId();this.editor=d;this.items=[];this._.listeners=[];this._.level=c.level||1;var e=CKEDITOR.tools.extend({},c.panel,{css:d.skin.editor.css,level:this._.level-1,block:{}});var b=e.block.attributes=(e.attributes||{});!b.role&&(b.role="menu");this._.panelDefinition=e},_:{onShow:function(){var g=this.editor.getSelection();if(CKEDITOR.env.ie){g&&g.lock()}var d=g&&g.getStartElement(),f=this._.listeners,e=[];this.removeAll();for(var c=0;c<f.length;c++){var b=f[c](d,g);if(b){for(var j in b){var h=this.editor.getMenuItem(j);if(h&&(!h.command||this.editor.getCommand(h.command).state)){h.state=b[j];this.add(h)}}}}},onClick:function(b){this.hide(false);if(b.onClick){b.onClick()}else{if(b.command){this.editor.execCommand(b.command)}}},onEscape:function(c){var b=this.parent;if(b){b._.panel.hideChild();var d=b._.panel._.panel._.currentBlock,e=d._.focusIndex;d._.markItem(e)}else{if(c==27){this.hide()}}return false},onHide:function(){if(CKEDITOR.env.ie){var b=this.editor.getSelection();b&&b.unlock()}this.onHide&&this.onHide()},showSubMenu:function(c){var g=this._.subMenu,e=this.items[c],i=e.getItems&&e.getItems();if(!i){this._.panel.hideChild();return}var f=this._.panel.getBlock(this.id);f._.focusIndex=c;if(g){g.removeAll()}else{g=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},true));g.parent=this;g._.onClick=CKEDITOR.tools.bind(this._.onClick,this)}for(var b in i){var h=this.editor.getMenuItem(b);if(h){h.state=i[b];g.add(h)}}var d=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+String(c));g.show(d,2)}},proto:{add:function(b){if(!b.order){b.order=this.items.length}this.items.push(b)},removeAll:function(){this.items=[]},show:function(b,f,q,p){if(!this.parent){this._.onShow();if(!this.items.length){return}}f=f||(this.editor.lang.dir=="rtl"?2:1);var n=this.items,e=this.editor,l=this._.panel,c=this._.element;if(!l){l=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level);l.onEscape=CKEDITOR.tools.bind(function(i){if(this._.onEscape(i)===false){return false}},this);l.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this);var g=l.addBlock(this.id,this._.panelDefinition.block);g.autoSize=true;var m=g.keys;m[40]="next";m[9]="next";m[38]="prev";m[CKEDITOR.SHIFT+9]="prev";m[(e.lang.dir=="rtl"?37:39)]=CKEDITOR.env.ie?"mouseup":"click";m[32]=CKEDITOR.env.ie?"mouseup":"click";CKEDITOR.env.ie&&(m[13]="mouseup");c=this._.element=g.element;c.addClass(e.skinClass);var j=c.getDocument();j.getBody().setStyle("overflow","hidden");j.getElementsByTag("html").getItem(0).setStyle("overflow","hidden");this._.itemOverFn=CKEDITOR.tools.addFunction(function(i){clearTimeout(this._.showSubTimeout);this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,e.config.menu_subMenuDelay||400,this,[i])},this);this._.itemOutFn=CKEDITOR.tools.addFunction(function(i){clearTimeout(this._.showSubTimeout)},this);this._.itemClickFn=CKEDITOR.tools.addFunction(function(i){var u=this.items[i];if(u.state==CKEDITOR.TRISTATE_DISABLED){this.hide();return}if(u.getItems){this._.showSubMenu(i)}else{this._.onClick(u)}},this)}a(n);var t=e.container.getChild(1),k=t.hasClass("cke_mixed_dir_content")?" cke_mixed_dir_content":"";var h=['<div class="cke_menu'+k+'" role="presentation">'];var d=n.length,s=d&&n[0].group;for(var o=0;o<d;o++){var r=n[o];if(s!=r.group){h.push('<div class="cke_menuseparator" role="separator"></div>');s=r.group}r.render(this,o,h)}h.push("</div>");c.setHtml(h.join(""));CKEDITOR.ui.fire("ready",this);if(this.parent){this.parent._.panel.showAsChild(l,this.id,b,f,q,p)}else{l.showBlock(this.id,b,f,q,p)}e.fire("menuShow",[l])},addListener:function(b){this._.listeners.push(b)},hide:function(b){this._.onHide&&this._.onHide();this._.panel&&this._.panel.hide(b)}}});function a(b){b.sort(function(d,c){if(d.group<c.group){return -1}else{if(d.group>c.group){return 1}}return d.order<c.order?-1:d.order>c.order?1:0})}CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(d,b,c){CKEDITOR.tools.extend(this,c,{order:0,className:"cke_button_"+b});this.group=d._.menuGroups[this.group];this.editor=d;this.name=b},proto:{render:function(f,j,g){var e=f.id+String(j),d=(typeof this.state=="undefined")?CKEDITOR.TRISTATE_OFF:this.state;var h=" cke_"+(d==CKEDITOR.TRISTATE_ON?"on":d==CKEDITOR.TRISTATE_DISABLED?"disabled":"off");var b=this.label;if(this.className){h+=" "+this.className}var c=this.getItems;g.push('<span class="cke_menuitem'+(this.icon&&this.icon.indexOf(".png")==-1?" cke_noalphafix":"")+'"><a id="',e,'" class="',h,'" href="javascript:void(\'',(this.label||"").replace("'",""),'\')" title="',this.label,'" tabindex="-1"_cke_focus=1 hidefocus="true" role="menuitem"'+(c?'aria-haspopup="true"':"")+(d==CKEDITOR.TRISTATE_DISABLED?'aria-disabled="true"':"")+(d==CKEDITOR.TRISTATE_ON?'aria-pressed="true"':""));if(CKEDITOR.env.opera||(CKEDITOR.env.gecko&&CKEDITOR.env.mac)){g.push(' onkeypress="return false;"')}if(CKEDITOR.env.gecko){g.push(' onblur="this.style.cssText = this.style.cssText;"')}var i=(this.iconOffset||0)*-16;g.push(' onmouseover="CKEDITOR.tools.callFunction(',f._.itemOverFn,",",j,');" onmouseout="CKEDITOR.tools.callFunction(',f._.itemOutFn,",",j,');" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction(',f._.itemClickFn,",",j,'); return false;"><span class="cke_icon_wrapper"><span class="cke_icon"'+(this.icon?' style="background-image:url('+CKEDITOR.getUrl(this.icon)+");background-position:0 "+i+'px;"':"")+'></span></span><span class="cke_label">');if(c){g.push('<span class="cke_menuarrow">',"<span>&#",(this.editor.lang.dir=="rtl"?"9668":"9658"),";</span>","</span>")}g.push(b,"</span></a></span>")}}})})();CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div";