CKEDITOR.plugins.add("esp_audio",{lang:["en","ru","uk"],init:function(a){var b=a.lang.esp_audio;if(typeof a.element.data=="undefined"){alert('The "audio" plugin requires CKEditor 3.5 or newer');return}CKEDITOR.dialog.add("esp_audio",this.path+"dialogs/esp_audio.js");a.addCommand("esp_audio",new CKEDITOR.dialogCommand("esp_audio"));a.ui.addButton("Esp_audio",{label:b.toolbar,command:"esp_audio",icon:this.path+"images/esp_audio.png"});a.addCss("img.cke_audio{background-image: url("+CKEDITOR.getUrl(this.path+"images/placeholder.png")+");background-position: center center;background-repeat: no-repeat;background-color: gray;border: 1px solid #a9a9a9;width: 300px;height: 64px;}");if(a.addMenuItems){a.addMenuItems({audio:{label:b.properties,command:"audio",group:"flash"}})}a.on("doubleclick",function(c){var d=c.data.element;if(d.is("img")&&d.data("cke-real-element-type")=="audio"){c.data.dialog="audio"}});if(a.contextMenu){a.contextMenu.addListener(function(c,d){if(c&&c.is("img")&&!c.isReadOnly()&&c.data("cke-real-element-type")=="audio"){return{audio:CKEDITOR.TRISTATE_OFF}}})}CKEDITOR.dtd.$empty["cke:source"]=1;CKEDITOR.dtd.$empty.source=1;a.lang.fakeobjects.audio=b.fakeObject},afterInit:function(c){var a=c.dataProcessor,e=a&&a.htmlFilter,d=a&&a.dataFilter;var b=c.plugins.googleMapsHandler;d.addRules({elements:{$:function(h){if(h.name=="audio"){h.name="cke:audio";var g=c.createFakeParserElement(h,"cke_audio","audio",false),j=g.attributes.style||"";var i=h.attributes.width,f=h.attributes.height,k=h.attributes.poster;if(typeof i!="undefined"){j=g.attributes.style=j+"width:"+CKEDITOR.tools.cssLength(i)+";"}if(typeof f!="undefined"){j=g.attributes.style=j+"height:"+CKEDITOR.tools.cssLength(f)+";"}if(k){j=g.attributes.style=j+"background-image:url("+k+");"}return g}}}});e.addRules({elements:{$:function(h){if(h.name=="img"){var j=h.attributes.mapnumber;if(j){var f,i=c.plugins.googleMapsHandler,g=i.getMap(j);if(g&&g.generatedType>1){i.CreatedMapsNames.push(g.number);f=new CKEDITOR.htmlParser.cdata(g.BuildScript());h.parent.children.push(f)}delete h.attributes.mapnumber}}return h}}})}});