CKEDITOR.dialog.add("esp_audio",function(f){var a=f.lang.esp_audio;function e(j,l){var k=this.getValue();if(!k&&this.id=="id"){k=h()}j.setAttribute(this.id,k);if(!k){return}switch(this.id){case"width":l.width=k+"px";break;case"height":l.height=k+"px";break}}function b(j,o,l){var k=this.id.match(/(\w+)(\d)/),p=k[1],n=parseInt(k[2],10);var m=l[n]||(l[n]={});m[p]=this.getValue()}function g(j){if(j){this.setValue(j.getAttribute(this.id))}else{if(this.id=="id"){this.setValue(h())}}}function c(j,l){var k=this.id.match(/(\w+)(\d)/),o=k[1],n=parseInt(k[2],10);var m=l[n];if(!m){return}this.setValue(m[o])}function h(){var j=new Date();return"audio"+j.getFullYear()+j.getMonth()+j.getDate()+j.getHours()+j.getMinutes()+j.getSeconds()}var d=function(){var j=this.previewImage;j.removeListener("load",d);j.removeListener("error",i);j.removeListener("abort",i);this.setValueOf("info","width",j.$.width);this.setValueOf("info","height",j.$.height)};var i=function(){var j=this.previewImage;j.removeListener("load",d);j.removeListener("error",i);j.removeListener("abort",i)};return{title:a.dialogTitle,minWidth:400,minHeight:50,onShow:function(){this.fakeImage=this.audioNode=null;this.previewImage=f.document.createElement("img");var j=this.getSelectedElement();if(j&&j.data("cke-real-element-type")&&j.data("cke-real-element-type")=="audio"){this.fakeImage=j;var k=f.restoreRealElement(j),l=[];l.push({src:k.getAttribute("src")});this.audioNode=k;this.setupContent(k,l)}else{this.setupContent(null,[])}},onOk:function(){var l=null;if(!this.fakeImage){l=CKEDITOR.dom.element.createFromHtml("<cke:audio></cke:audio>",f.document);l.setAttributes({controls:"controls",src:this.getValueOf("info","src0")})}else{l=this.audioNode}var q={},n=[];this.commitContent(l,q,n);var k="",j="",o=a.linkTemplate||"",m=a.fallbackTemplate||"";j=o.replace("%src%",this.getValueOf("info","src0")).replace("%type%",this.getValueOf("info","src0").split("/").pop());l.setHtml(k+m.replace("%links%",j));var p=f.createFakeElement(l,"cke_audio","audio",false);p.setStyles(q);if(this.fakeImage){p.replace(this.fakeImage);f.getSelection().selectElement(p)}else{f.insertElement(p)}},onHide:function(){if(this.previewImage){this.previewImage.removeListener("load",d);this.previewImage.removeListener("error",i);this.previewImage.removeListener("abort",i);this.previewImage.remove();this.previewImage=null}},contents:[{id:"info",elements:[{type:"hbox",widths:["320px","80px"],children:[{type:"text",id:"src0",label:a.sourceAudio,commit:b,setup:c},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:10px;",filebrowser:{action:"Browse",target:"info:src0",url:f.config.filebrowserAudioBrowseUrl||f.config.filebrowserBrowseUrl},label:f.lang.esp_audio.browseServer}]}]}]}});